<!DOCTYPE html>
<!--
  æ±‰å­—ç»ƒä¹ è¿çº¿æ¸¸æˆ â€” Chinese Matching Game
  Copyright Â© 2026 iwemeada LLC. All Rights Reserved.
-->
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ±‰å­—è¿çº¿ç»ƒä¹  Chinese Matching Game</title>
  <!-- Nintendo Switch kid-friendly style -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800;900&family=Noto+Serif+SC:wght@700&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      /* Nintendo Switch palette */
      --sw-red:    #E4000F;   /* Joy-Con left red */
      --sw-blue:   #0AB9E6;   /* Joy-Con right blue */
      --sw-orange: #FF8200;   /* accent / highlight */
      --sw-dark:   #1A1A2E;   /* near-black UI chrome */
      --sw-panel:  #F0F0F5;   /* screen panel bg */
      --sw-white:  #FFFFFF;

      --correct: #39D353;
      --wrong:   #E4000F;
      --card-bg: #FFFFFF;
      --radius:  20px;
      --shadow:  0 6px 0px rgba(0,0,0,.22), 0 2px 14px rgba(0,0,0,.14);
      --font-zh: 'Noto Serif SC', 'KaiTi', 'STKaiti', serif;
      --font-en: 'Nunito', 'Segoe UI', sans-serif;
    }

    /* â”€â”€ Warm peach background with subtle dots â”€â”€ */
    body {
      font-family: var(--font-en);
      background-color: #fcb69f;
      background-image:
        linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%),
        radial-gradient(circle, rgba(255,255,255,.25) 1px, transparent 1px);
      background-size: 100% 100%, 26px 26px;
      height: 100vh;
      height: 100dvh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px 16px 6px;
      gap: 7px;
      user-select: none;
    }

    /* â”€â”€ Joy-Con rail strip at top & bottom â”€â”€ */
    body::before, body::after {
      content: '';
      position: fixed; left: 0; right: 0; height: 10px; z-index: 1000;
      background: linear-gradient(90deg, var(--sw-red) 0%, var(--sw-red) 48%,
                  var(--sw-dark) 48%, var(--sw-dark) 52%,
                  var(--sw-blue) 52%, var(--sw-blue) 100%);
    }
    body::before { top: 0; border-radius: 0 0 6px 6px; }
    body::after  { bottom: 0; border-radius: 6px 6px 0 0; }

    /* â”€â”€ Top bar â”€â”€ */
    .top-bar {
      width: 100%; max-width: 920px;
      display: flex; flex-direction: column; gap: 6px; flex-shrink: 0;
      background: rgba(255,255,255,.55);
      border-radius: 20px; padding: 8px 14px;
      border: 2px solid rgba(255,255,255,.7);
      backdrop-filter: blur(8px);
      margin-top: 6px;
      box-shadow: 0 2px 12px rgba(0,0,0,.10);
    }
    .top-row1 { display: flex; align-items: center; justify-content: center; gap: 10px; flex-wrap: wrap; }
    .top-row2 { display: flex; align-items: center; justify-content: center; gap: 10px; flex-wrap: wrap; }

    header { text-align: center; }
    header h1 {
      font-size: clamp(1rem, 2.8vw, 1.55rem);
      color: #4a2c00;
      font-family: var(--font-zh);
      letter-spacing: .06em;
      text-shadow: 1px 2px 3px rgba(0,0,0,.12);
      white-space: nowrap;
      font-weight: 700;
    }

    /* â”€â”€ Buttons â€” chunky Joy-Con pill style â”€â”€ */
    .controls { display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; }
    .btn {
      padding: 9px 22px; border: none; border-radius: 50px;
      font-size: 1rem; font-weight: 900; cursor: pointer; font-family: var(--font-en);
      letter-spacing: .03em;
      transition: transform .1s, box-shadow .1s, filter .1s;
      box-shadow: 0 2px 6px rgba(0,0,0,.18);
      position: relative; top: 0;
    }
    .btn:active {
      transform: scale(.95);
      box-shadow: 0 1px 3px rgba(0,0,0,.18);
      top: 0;
    }
    /* Switch-style button bounce */
    .btn:hover { filter: brightness(1.12); }
    .btn-primary { background: var(--sw-red);    color: #fff; }
    .btn-accent  { background: var(--sw-blue);   color: #fff; }
    .btn-neutral { background: #4A4A6A;           color: #ddd; }
    .btn-switch  { background: var(--sw-orange);  color: #fff; }

    /* â”€â”€ Scoreboard â”€â”€ */
    .scoreboard {
      display: flex; gap: 14px; font-size: 1rem; font-weight: 800;
      color: #4a2c00;
      background: rgba(255,255,255,.65); padding: 5px 16px; border-radius: 50px;
      border: 2px solid rgba(255,255,255,.8);
      backdrop-filter: blur(4px);
    }
    .scoreboard span { display: flex; align-items: center; gap: 4px; }

    .round-info { font-size: .9rem; font-weight: 700; color: #7a4500; text-align: center; }

    /* â”€â”€ Game wrapper (Switch "screen" panel) â”€â”€ */
    .game-wrapper {
      position: relative; width: 100%; max-width: 920px;
      flex: 1; min-height: 0; touch-action: none;
    }
    #line-canvas {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; overflow: visible; z-index: 10;
    }

    /* â”€â”€ Columns â”€â”€ */
    .columns {
      display: flex; justify-content: space-between; align-items: stretch;
      gap: 52px; width: 100%; height: 100%; position: relative; z-index: 1;
      padding: 10px;
    }
    .col { display: flex; flex-direction: column; gap: 6px; flex: 1; min-width: 0; height: 100%; }

    /* â”€â”€ Cards â€” thick border "game cartridge" feel â”€â”€ */
    .match-card {
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 4px 16px rgba(0,0,0,.12);
      padding: 4px 10px;
      cursor: pointer;
      border: 3px solid #D0D0E0;
      transition: border-color .13s, transform .12s, box-shadow .12s;
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1;
      min-height: 0;
    }
    .match-card.left-card:hover  {
      transform: translateX(5px) scale(1.02);
      box-shadow: 0 6px 20px rgba(0,0,0,.15);
      border-color: var(--sw-blue);
    }
    .match-card.right-card:hover {
      transform: translateX(-5px) scale(1.02);
      box-shadow: 0 6px 20px rgba(0,0,0,.15);
      border-color: var(--sw-red);
    }
    .match-card.selected {
      border-color: var(--sw-orange);
      box-shadow: 0 4px 16px rgba(0,0,0,.12), 0 0 0 3px rgba(255,130,0,.35);
    }
    .match-card.left-card.selected  { transform: translateX(5px) scale(1.03); }
    .match-card.right-card.selected { transform: translateX(-5px) scale(1.03); }
    .match-card.matched {
      border-color: var(--correct);
      background: linear-gradient(135deg, #e8fff0, #d0f5dc);
      box-shadow: 0 4px 14px rgba(57,211,83,.2);
      pointer-events: none;
    }
    .match-card.wrong { border-color: var(--wrong); animation: shake .35s; }

    /* â”€â”€ Card inner layout â”€â”€ */
    .card-row { display: flex; align-items: center; gap: 8px; width: 100%; }
    .card-content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; }
    .card-pinyin  { font-size: clamp(.85rem, 2vh, 1.3rem); color: #888; letter-spacing: .04em; text-align: center; line-height: 1.1; }
    .card-chinese {
      font-family: var(--font-zh);
      font-size: clamp(1.1rem, 3.2vh, 2.2rem);
      color: #2c1000;
      font-weight: 700;
      text-align: center;
      line-height: 1.15;
    }
    .card-img {
      width: auto; height: min(7vh, 62px); max-width: 100%;
      object-fit: contain; display: block;
      filter: drop-shadow(1px 2px 3px rgba(0,0,0,.12));
    }
    .img-error { font-size: .7rem; color: #bbb; text-align: center; padding: 6px; }

    /* â”€â”€ Dot anchors â€” Joy-Con button style â”€â”€ */
    .dot-right, .dot-left {
      display: inline-block; width: 12px; height: 12px;
      border-radius: 50%;
      background: #ccc;
      border: 2px solid #aaa;
      flex-shrink: 0;
    }

    /* â”€â”€ Lines â”€â”€ */
    .connector-line { stroke-linecap: round; fill: none; stroke-width: 4; filter: drop-shadow(1px 2px 3px rgba(0,0,0,.25)); }
    .line-pending { stroke: var(--sw-orange); stroke-dasharray: 8 5; stroke-width: 3; }
    .line-correct { stroke: var(--correct); stroke-width: 4.5; }
    .line-wrong   { stroke: var(--wrong);   stroke-width: 4.5; }

    /* â”€â”€ Progress bar â”€â”€ */
    .progress-wrap {
      width: 100%; max-width: 920px;
      background: rgba(255,255,255,.45);
      border-radius: 50px; height: 10px; flex-shrink: 0; overflow: hidden;
      border: 1.5px solid rgba(255,255,255,.6);
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--sw-orange), #f4845f, var(--sw-blue));
      border-radius: 50px;
      transition: width .4s cubic-bezier(.34,1.56,.64,1);
    }

    /* â”€â”€ Level badge â€” rounded pill â”€â”€ */
    .level-badge {
      font-size: .9rem; font-weight: 900; padding: 5px 16px; border-radius: 50px;
      letter-spacing: .03em;
      box-shadow: 0 2px 6px rgba(0,0,0,.15);
      transition: background .4s, color .4s; white-space: nowrap;
      border: 2px solid rgba(255,255,255,.3);
      font-family: var(--font-en);
    }
    .level-badge.lv1  { background: #39D353; color: #fff; }
    .level-badge.lv2  { background: #FF8200; color: #fff; }
    .level-badge.lv3  { background: #E4000F; color: #fff; }
    .level-badge.lv4  { background: #9B59B6; color: #fff; }
    .level-badge.lv5  { background: #0AB9E6; color: #fff; }
    .level-badge.lv6  { background: #FF8C00; color: #fff; }
    .level-badge.lv7  { background: #1E90FF; color: #fff; }
    .level-badge.lv8  { background: #FF69B4; color: #fff; }
    .level-badge.lv9  { background: #2ECC71; color: #fff; }
    .level-badge.lv10 { background: #F39C12; color: #fff; }
    .level-badge.lv11 { background: #8E44AD; color: #fff; }

    /* â”€â”€ Feedback popup â”€â”€ */
    .feedback {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%,-50%) scale(.6);
      background: #fff;
      border-radius: 28px;
      padding: 24px 40px; text-align: center;
      box-shadow: 0 12px 40px rgba(0,0,0,.18);
      z-index: 100; display: none; flex-direction: column; align-items: center; gap: 12px;
      cursor: pointer;
      border: 2px solid rgba(244,132,95,.25);
    }
    .feedback.show { display: flex; animation: popIn .3s cubic-bezier(.22,.68,0,1.45) forwards; }
    .feedback .emoji { font-size: 3.5rem; animation: wobble .6s ease; }
    .feedback .msg   { font-size: 1.5rem; font-weight: 900; color: #4a2c00; font-family: var(--font-en); }
    .feedback .sub   { font-size: .95rem; color: #7a4500; font-weight: 700; }

    /* â”€â”€ Complete overlay â”€â”€ */
    .complete-overlay {
      position: fixed; inset: 0;
      background: rgba(120,60,20,.45);
      backdrop-filter: blur(4px);
      display: none; align-items: center; justify-content: center; z-index: 200;
    }
    .complete-overlay.show { display: flex; animation: fadeInOverlay .25s ease; }
    .complete-box {
      background: #fff;
      border-radius: 32px; padding: 36px 48px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,.20);
      max-width: 480px; width: 92%;
      border: 2px solid rgba(244,132,95,.25);
      animation: popIn .35s cubic-bezier(.22,.68,0,1.36) forwards;
    }
    .complete-box .big-emoji { font-size: 4.5rem; margin-bottom: 10px; animation: bounce 0.6s ease; }
    .complete-box h2 {
      font-size: 1.9rem; color: #4a2c00; margin-bottom: 8px;
      font-family: var(--font-zh); font-weight: 900;
    }
    .complete-box .stats { font-size: 1rem; color: #7a4500; margin-bottom: 20px; font-weight: 700; }
    .stars { font-size: 2.4rem; margin-bottom: 8px; letter-spacing: 6px; }

    /* â”€â”€ Game Selector overlay â”€â”€ */
    .selector-overlay {
      position: fixed; inset: 0; background: rgba(120,60,20,.45);
      backdrop-filter: blur(4px);
      display: none; align-items: center; justify-content: center; z-index: 300;
    }
    .selector-overlay.show { display: flex; }
    .selector-box {
      background: #fff; border-radius: 30px; padding: 28px 32px;
      box-shadow: 0 20px 60px rgba(0,0,0,.18);
      max-width: 540px; width: 92%;
      max-height: 88vh; overflow-y: auto;
      border: 2px solid rgba(10,185,230,.2);
    }
    .selector-box h2 {
      font-size: 1.5rem; color: #4a2c00; margin-bottom: 6px;
      font-family: var(--font-zh); text-align: center; font-weight: 900;
    }
    .selector-box p.sub { font-size: .9rem; color: #666; text-align: center; margin-bottom: 16px; font-weight: 700; }
    .pack-list { display: flex; flex-direction: column; gap: 10px; }
    .pack-item {
      display: flex; align-items: center; gap: 14px;
      padding: 13px 16px; border-radius: 18px; border: 3px solid #E0E0F0;
      cursor: pointer; transition: border-color .13s, background .13s, transform .1s;
      background: #F7F7FF;
      box-shadow: 0 2px 8px rgba(0,0,0,.08);
    }
    .pack-item:hover  { border-color: var(--sw-blue); background: #eaf8fd; transform: scale(1.01); }
    .pack-item.active-pack { border-color: var(--correct); background: #e8fff0; }
    .pack-icon { font-size: 2.2rem; flex-shrink: 0; }
    .pack-info { flex: 1; }
    .pack-name  { font-size: 1.05rem; font-weight: 900; color: #4a2c00; }
    .pack-desc  { font-size: .84rem; color: #666; margin-top: 2px; font-weight: 700; }
    .pack-levels{ font-size: .76rem; color: #aaa; margin-top: 2px; font-weight: 700; }
    .selector-close {
      margin-top: 18px; width: 100%; padding: 13px; border: none;
      border-radius: 50px; background: var(--sw-red); color: #fff;
      font-size: 1.05rem; font-weight: 900; cursor: pointer; font-family: var(--font-en);
      box-shadow: 0 2px 6px rgba(0,0,0,.18);
      transition: transform .1s, box-shadow .1s;
    }
    .selector-close:active { transform: scale(.96); box-shadow: 0 1px 3px rgba(0,0,0,.18); }

    /* â”€â”€ Attribution â”€â”€ */
    .attribution {
      width: 100%; max-width: 920px; flex-shrink: 0;
      text-align: center; font-size: .72rem; color: #8a5c2e;
      background: rgba(255,255,255,.40); border-radius: 10px; padding: 4px 12px; line-height: 1.6;
    }
    .attribution a { color: #7a4500; text-decoration: underline; text-decoration-style: dotted; }
    .attribution a:hover { color: var(--sw-red); }
    .attr-own  { display: block; font-weight: 700; color: #5a3800; }
    .attr-img  { display: block; color: #8a5c2e; }

    /* â”€â”€ Animations â”€â”€ */
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      20%      { transform: translateX(-7px) rotate(-2deg); }
      40%      { transform: translateX(7px)  rotate(2deg); }
      60%      { transform: translateX(-5px) rotate(-1deg); }
      80%      { transform: translateX(5px)  rotate(1deg); }
    }
    @keyframes popIn {
      from { transform: translate(-50%,-50%) scale(.5) rotate(-4deg); opacity: 0; }
      to   { transform: translate(-50%,-50%) scale(1)  rotate(0deg);  opacity: 1; }
    }
    @keyframes wobble {
      0%   { transform: rotate(0deg) scale(1); }
      25%  { transform: rotate(-12deg) scale(1.15); }
      50%  { transform: rotate(10deg) scale(1.1); }
      75%  { transform: rotate(-6deg) scale(1.05); }
      100% { transform: rotate(0deg) scale(1); }
    }
    @keyframes bounce {
      0%   { transform: translateY(0); }
      40%  { transform: translateY(-18px); }
      70%  { transform: translateY(-8px); }
      100% { transform: translateY(0); }
    }
    @keyframes fadeInOverlay {
      from { opacity: 0; }
      to   { opacity: 1; }
    }
    @keyframes lineFlash {
      0%   { stroke-opacity: 1; }
      50%  { stroke-opacity: .2; }
      100% { stroke-opacity: 1; }
    }
    .line-flash { animation: lineFlash .4s ease 2; }

    /* â”€â”€ Responsive â”€â”€ */
    @media (max-width: 768px) {
      body         { padding: 6px 8px 4px; gap: 4px; }
      .top-bar     { gap: 4px; padding: 6px 10px; }
      .top-row1, .top-row2 { gap: 6px; }
      .columns     { gap: 14px; padding: 6px; }
      .match-card  { padding: 3px 6px; border-radius: 14px; }
      .card-img    { height: min(6.5vh, 52px); }
      .btn         { padding: 7px 14px; font-size: .88rem; }
      .level-badge { font-size: .76rem; padding: 4px 10px; }
      .scoreboard  { font-size: .8rem; padding: 4px 12px; gap: 8px; }
      .round-info  { font-size: .8rem; }
      header h1    { font-size: clamp(.88rem, 3.5vw, 1.2rem); white-space: normal; }
      .complete-box { padding: 26px 22px; }
      .selector-box { padding: 22px 16px; }
    }
  </style>
</head>
<body>

<div class="top-bar">
  <div class="top-row1">
    <header><h1 id="app-title">ğŸ–Œï¸ æ±‰å­—è¿çº¿ç»ƒä¹ </h1></header>
    <div class="level-badge lv1" id="level-badge">â­ Level 1</div>
    <div class="scoreboard">
      <span>âœ… <span id="score-correct">0</span> / <span id="score-total">8</span></span>
      <span>âŒ <span id="score-wrong">0</span></span>
    </div>
  </div>
  <div class="progress-wrap">
    <div class="progress-bar" id="progress-bar" style="width:0%"></div>
  </div>
  <div class="top-row2">
    <div class="controls">
      <button class="btn btn-switch"   onclick="openSelector()">ğŸ® Switch Game</button>
      <button class="btn btn-primary"  onclick="retryLevel()">ğŸ” Retry</button>
      <button class="btn btn-accent"   onclick="resetAll()">ğŸ”„ Restart</button>
      <button class="btn btn-neutral"  onclick="toggleHelp()">ğŸ’¡ Help</button>
    </div>
    <div class="round-info" id="round-info">Loadingâ€¦</div>
  </div>
</div>

<div class="game-wrapper" id="game-wrapper">
  <svg id="line-canvas" xmlns="http://www.w3.org/2000/svg"></svg>
  <div class="columns" id="columns">
    <div class="col" id="col-left"></div>
    <div class="col" id="col-right"></div>
  </div>
</div>

<footer class="attribution">
  <div class="attr-own">
    ğŸ® Game design &amp; code &copy; 2026 IWEMEADA LLC &mdash; All Rights Reserved.
  </div>
  <div class="attr-img" id="attr-img">
    Stroke images &copy; <a href="https://commons.wikimedia.org/wiki/User:Cangjie6" target="_blank" rel="noopener">Cangjie6</a>
    via <a href="https://commons.wikimedia.org/" target="_blank" rel="noopener">Wikimedia Commons</a>,
    <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">CC BY-SA 4.0</a>.
  </div>
</footer>

<!-- Feedback popup -->
<div class="feedback" id="feedback">
  <div class="emoji" id="fb-emoji">âœ…</div>
  <div class="msg"   id="fb-msg">Correct!</div>
  <div class="sub"   id="fb-sub"></div>
</div>

<!-- Completion overlay -->
<div class="complete-overlay" id="complete-overlay">
  <div class="complete-box">
    <div class="big-emoji" id="co-emoji">ğŸ‰</div>
    <div class="stars"     id="co-stars">â­â­â­</div>
    <h2 id="co-title">å¤ªæ£’äº†ï¼</h2>
    <div class="stats" id="co-stats"></div>
    <button class="btn btn-primary" id="co-btn" onclick="nextLevel()">â–¶ Next Level</button>
  </div>
</div>

<!-- Game Selector overlay -->
<div class="selector-overlay" id="selector-overlay">
  <div class="selector-box">
    <h2>ğŸ® é€‰æ‹©æ¸¸æˆ Choose a Game</h2>
    <p class="sub">Pick a matching category to practise</p>
    <div class="pack-list" id="pack-list"></div>
    <button class="selector-close" onclick="closeSelector()">âœ… Start Playing</button>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GENERIC DATA SCHEMA
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   GAME_PACKS: Array of GamePack
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   GamePack {
     id        : string          â€” unique key
     icon      : string          â€” emoji
     name      : string          â€” display name (EN)
     nameCN    : string          â€” display name (ZH)
     desc      : string          â€” short description
     attribution: string|null    â€” HTML string shown in footer (null = hide)
     levels: Array of Level {
       id         : number
       label      : string       â€” full label shown in round-info
       shortLabel : string       â€” short label shown in badge
       cls        : 'lv1'|'lv2'|'lv3'
       pairs: Array of Pair {
         left  : CardData
         right : CardData
       }
     }
   }

   CardData {
     pinyin  : string | null   â€” romanisation / pronunciation hint
     chinese : string | null   â€” Chinese characters
     img     : string | null   â€” image URL
   }
   At least one of (chinese, img) should be non-null.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ Helper: build a CardData quickly â”€â”€ */
const card = (pinyin, chinese, img = null) => ({ pinyin, chinese, img });
const imgOnly = (img, alt = null) => ({ pinyin: null, chinese: alt, img });

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PACK 1 â€” Stroke Matching (original game)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PACK_STROKES = {
  id: 'strokes',
  icon: 'ğŸ–Œï¸',
  name: 'Stroke Names',
  nameCN: 'æ±‰å­—ç¬”ç”»',
  desc: 'Match stroke names to their written form',
  attribution: `Stroke images &copy; <a href="https://commons.wikimedia.org/wiki/User:Cangjie6" target="_blank" rel="noopener">Cangjie6</a>
    via <a href="https://commons.wikimedia.org/" target="_blank" rel="noopener">Wikimedia Commons</a>,
    <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">CC BY-SA 4.0</a>, used unmodified for educational purposes.`,
  levels: [
    {
      id: 1, cls: 'lv1',
      label:      'â­ Level 1 â€” Basic Strokes åŸºç¡€ç¬”ç”»',
      shortLabel: 'â­ Level 1',
      pairs: [
        { left: card('hÃ©ng',    'æ¨ª'),   right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/7/72/Cjk_k_str_h.svg',  'æ¨ª') },
        { left: card('shÃ¹',     'ç«–'),   right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/f/ff/Cjk_k_str_v.svg',  'ç«–') },
        { left: card('diÇn',    'ç‚¹'),   right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/5/59/Cjk_k_str_d.svg',  'ç‚¹') },
        { left: card('piÄ›',     'æ’‡'),   right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/e/ed/Cjk_k_str_t.svg',  'æ’‡') },
        { left: card('nÃ ',      'æº'),   right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/3/39/Cjk_k_str_p.svg',  'æº') },
        { left: card('tÃ­',      'æ'),   right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/9/92/Cjk_k_str_u.svg',  'æ') },
        { left: card('shÃ¹ gÅu','ç«–é’©'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/7/79/Cjk_k_str_vj.svg', 'ç«–é’©') },
        { left: card('wÄn gÅu','å¼¯é’©'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/a/a2/Cjk_k_str_cj.svg', 'å¼¯é’©') },
      ]
    },
    {
      id: 2, cls: 'lv2',
      label:      'â­â­ Level 2 â€” Compound Strokes å¤åˆç¬”ç”»',
      shortLabel: 'â­â­ Level 2',
      pairs: [
        { left: card('hÃ©ng zhÃ©','æ¨ªæŠ˜'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/d/de/Cjk_k_str_hv.svg',  'æ¨ªæŠ˜') },
        { left: card('shÃ¹ zhÃ©', 'ç«–æŠ˜'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/c/c4/Cjk_k_str_vh.svg',  'ç«–æŠ˜') },
        { left: card('hÃ©ng gÅu','æ¨ªé’©'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/5/51/Cjk_k_str_hj.svg',  'æ¨ªé’©') },
        { left: card('shÃ¹ wÄn', 'ç«–å¼¯'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/c/cc/Cjk_k_str_va.svg',  'ç«–å¼¯') },
        { left: card('piÄ› diÇn','æ’‡ç‚¹'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/d/d7/Cjk_k_str_td.svg',  'æ’‡ç‚¹') },
        { left: card('piÄ› zhÃ©', 'æ’‡æŠ˜'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/a/a4/Cjk_k_str_tu.svg',  'æ’‡æŠ˜') },
        { left: card('xiÃ© gÅu', 'æ–œé’©'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/e/ec/Cjk_k_str_pj.svg',  'æ–œé’©') },
        { left: card('wÃ² gÅu',  'å§é’©'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/0/06/Cjk_k_str_fpj.svg', 'å§é’©') },
        { left: card('shÃ¹ tÃ­',  'ç«–æ'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/7/75/Cjk_k_str_vu.svg',  'ç«–æ') },
      ]
    },
    {
      id: 3, cls: 'lv3',
      label:      'â­â­â­ Level 3 â€” Complex Strokes å¤æ‚ç¬”ç”»',
      shortLabel: 'â­â­â­ Level 3',
      pairs: [
        { left: card('shÃ¹ wÄn gÅu',      'ç«–å¼¯é’©'),  right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/1/1a/Cjk_k_str_vaj.svg') },
        { left: card('hÃ©ng zhÃ© gÅu',     'æ¨ªæŠ˜é’©'),  right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/a/ac/Cjk_k_str_hvj.svg') },
        { left: card('hÃ©ng zhÃ© tÃ­',      'æ¨ªæŠ˜æ'),  right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/1/12/Cjk_k_str_hvu.svg') },
        { left: card('hÃ©ng piÄ›',         'æ¨ªæ’‡'),    right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/9/9d/Cjk_k_str_ht.svg') },
        { left: card('hÃ©ng zhÃ© wÄn gÅu', 'æ¨ªæŠ˜å¼¯é’©'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/8/8f/Cjk_k_str_haj.svg') },
        { left: card('shÃ¹ zhÃ© zhÃ© gÅu',  'ç«–æŠ˜æŠ˜é’©'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/9/9f/Cjk_k_str_vhtj.svg') },
        { left: card('hÃ©ng piÄ› wÄn gÅu', 'æ¨ªæ’‡å¼¯é’©'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/0/02/Cjk_k_str_htcj.svg') },
        { left: card('hÃ©ng zhÃ© zhÃ© piÄ›', 'æ¨ªæŠ˜æŠ˜æ’‡'), right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/8/89/Cjk_k_str_htht.svg') },
        { left: card('hÃ©ng zhÃ© wÄn',     'æ¨ªæŠ˜å¼¯'),  right: imgOnly('https://upload.wikimedia.org/wikipedia/commons/4/45/Cjk_k_str_ha.svg') },
      ]
    }
  ]
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PACK 2 â€” Antonyms åä¹‰è¯
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PACK_ANTONYMS = {
  id: 'antonyms',
  icon: 'â†”ï¸',
  name: 'Antonyms',
  nameCN: 'åä¹‰è¯',
  desc: 'Match each word with its opposite',
  attribution: null,
  levels: [
    {
      id: 1, cls: 'lv1',
      label:      'â­ Level 1 â€” Basic Opposites åŸºç¡€åä¹‰è¯',
      shortLabel: 'â­ Level 1',
      pairs: [
        { left: card(null, 'å¤§'), right: card(null, 'å°') },
        { left: card(null, 'å¤š'), right: card(null, 'å°‘') },
        { left: card(null, 'å¿«'), right: card(null, 'æ…¢') },
        { left: card(null, 'æ¥'), right: card(null, 'å»') },
        { left: card(null, 'ä¸Š'), right: card(null, 'ä¸‹') },
        { left: card(null, 'å·¦'), right: card(null, 'å³') },
        { left: card(null, 'é»‘'), right: card(null, 'ç™½') },
        { left: card(null, 'å¼€'), right: card(null, 'å…³') },
      ]
    },
    {
      id: 2, cls: 'lv2',
      label:      'â­â­ Level 2 â€” Descriptive Opposites æè¿°åä¹‰è¯',
      shortLabel: 'â­â­ Level 2',
      pairs: [
        { left: card(null,  'æ–°'), right: card(null,  'æ—§') },
        { left: card(null,  'å†·'), right: card(null,  'çƒ­') },
        { left: card(null,  'é«˜'), right: card(null,  'çŸ®') },
        { left: card(null,  'è¿œ'), right: card(null,  'è¿‘') },
        { left: card(null,  'çœŸ'), right: card('jiÇ', 'å‡') },
        { left: card(null,  'å¯¹'), right: card('cuÃ²', 'é”™') },
        { left: card(null,  'é‡Œ'), right: card(null,  'å¤–') },
        { left: card(null,  'å‰'), right: card(null,  'å') },
      ]
    },
    {
      id: 3, cls: 'lv3',
      label:      'â­â­â­ Level 3 â€” Action & State Opposites åŠ¨ä½œåä¹‰è¯',
      shortLabel: 'â­â­â­ Level 3',
      pairs: [
        { left: card(null,     'æœ‰'),  right: card(null,       'æ— ') },
        { left: card(null,     'æ—©'),  right: card(null,       'æ™š') },
        { left: card(null,     'ç›´'),  right: card(null,       'å¼¯') },
        { left: card(null,     'ç»†'),  right: card('cÅ«',       'ç²—') },
        { left: card(null,     'å‡‰'),  right: card(null,       'çƒ­') },
        { left: card(null,     'åŠ '),  right: card(null,       'å‡') },
        { left: card(null,     'å¼€å¿ƒ'), right: card('nÃ¡n guÃ²',  'éš¾è¿‡') },
      ]
    },
    {
      id: 4, cls: 'lv4',
      label:      'â­â­â­â­ Level 4 â€” Qualities & Emotions æ€§è´¨æƒ…æ„Ÿ',
      shortLabel: 'â­â­â­â­ Level 4',
      pairs: [
        { left: card(null, 'èªæ˜'), right: card(null, 'ç¬¨')  },
        { left: card(null, 'å¹²å‡€'), right: card(null, 'è„')  },
        { left: card(null, 'é«˜å…´'), right: card(null, 'ç”Ÿæ°”') },
        { left: card(null, 'è„±'),   right: card(null, 'ç©¿')  },
        { left: card(null, 'è½»'),   right: card(null, 'å“')  },
        { left: card(null, 'æ”¶'),   right: card(null, 'æ”¾')  },
        { left: card(null, 'å…ˆ'),   right: card(null, 'å')  },
      ]
    },
    {
      id: 5, cls: 'lv5',
      label:      'â­â­â­â­â­ Level 5 â€” Simple Compounds ç®€å•å¤åˆ',
      shortLabel: 'â­â­â­â­â­ Level 5',
      pairs: [
        { left: card(null,    'å¤´'), right: card(null,    'å°¾') },
        { left: card(null,    'å‡º'), right: card(null,    'è¿›') },
        { left: card(null,    'å‡'), right: card('jiÃ ng', 'é™') },
        { left: card(null,    'æ­£'), right: card('fÇn',   'å') },
      ]
    },
    {
      id: 6, cls: 'lv6',
      label:      'â­â­â­â­â­â­ Level 6 â€” Compound Phrases å¤åˆçŸ­è¯­',
      shortLabel: 'â­â­â­â­â­â­ Level 6',
      pairs: [
        { left: card(null,        'å‡ºå»'), right: card(null,        'è¿›æ¥') },
        { left: card(null,        'å‡èµ·'), right: card('jiÃ ng luÃ²', 'é™è½') },
        { left: card(null,        'æ­£é¢'), right: card('fÇn miÃ n',  'åé¢') },
        { left: card(null,        'çå¼€'), right: card(null,        'é—­ä¸Š') },
      ]
    },
  ]
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PACK 3 â€” Measure Words (placeholder â€” replace with real data)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PACK_MEASURE = {
  id: 'measure',
  icon: 'ğŸ“',
  name: 'Measure Words',
  nameCN: 'é‡è¯',
  desc: 'Match the measure word to what it counts',
  attribution: null,
  levels: [
    {
      // Each measure word â†’ one unambiguous noun from OCR data
      // å¯¹ å¥½æœ‹å‹ | é“ å½©è™¹ | æ£µ æ ‘ | é¢ é•œå­ | è¢‹ è‹¹æœ | æœµ èŠ± | ä»¶ ç¤¼ç‰© | é¡¶ å¸½å­
      id: 1, cls: 'lv1',
      label:      'â­ Level 1 â€” Measure Words é‡è¯ï¼ˆä¸€ï¼‰',
      shortLabel: 'â­ Level 1',
      pairs: [
        { left: card(null, 'å¯¹'), right: card(null,           'å¥½æœ‹å‹') },
        { left: card(null, 'é“'), right: card(null,           'å½©è™¹')   },
        { left: card(null, 'æ£µ'), right: card(null,           'æ ‘')     },
        { left: card(null, 'é¢'), right: card(null,           'é•œå­')   },
        { left: card(null, 'è¢‹'), right: card(null,           'è‹¹æœ')   },
        { left: card(null, 'æœµ'), right: card(null,           'èŠ±')     },
        { left: card(null, 'ä»¶'), right: card(null,           'ç¤¼ç‰©')   },
        { left: card(null, 'é¡¶'), right: card(null,           'å¸½å­')   },
      ]
    },
    {
      // å¯¹ èŠ±ç“¶ | é“ èœ | æ£µ è‰ | é¢ æ——å­ | è¢‹ é¢åŒ… | æœµ äº‘ | ä»¶ äº‹æƒ… | é¡¶ ä¼
      id: 2, cls: 'lv2',
      label:      'â­â­ Level 2 â€” Measure Words é‡è¯ï¼ˆäºŒï¼‰',
      shortLabel: 'â­â­ Level 2',
      pairs: [
        { left: card(null, 'å¯¹'), right: card(null,           'èŠ±ç“¶')   },
        { left: card(null, 'é“'), right: card(null,           'èœ')     },
        { left: card(null, 'æ£µ'), right: card(null,           'è‰')     },
        { left: card(null, 'é¢'), right: card(null,           'æ——å­')   },
        { left: card(null, 'è¢‹'), right: card(null,           'é¢åŒ…')   },
        { left: card(null, 'æœµ'), right: card(null,           'äº‘')     },
        { left: card(null, 'ä»¶'), right: card(null,           'äº‹æƒ…')   },
        { left: card(null, 'é¡¶'), right: card('zhÃ ng pÃ©ng',   'å¸ç¯·')   },
      ]
    },
    {
      // ç§ æ°´æœ | åŒ¹ é©¬ | æ ¹ ç­·å­ | å› æ¸¸æˆ | åº§ å±± | å¯¹ é¸Ÿ | åŒ é‹ | å¥— è¡£æœ
      id: 3, cls: 'lv3',
      label:      'â­â­â­ Level 3 â€” Measure Words é‡è¯ï¼ˆä¸‰ï¼‰',
      shortLabel: 'â­â­â­ Level 3',
      pairs: [
        { left: card(null, 'ç§'), right: card(null, 'æ°´æœ') },
        { left: card(null, 'åŒ¹'), right: card(null, 'é©¬')   },
        { left: card(null, 'æ ¹'), right: card(null, 'ç­·å­') },
        { left: card(null, 'å›'), right: card(null, 'æ¸¸æˆ') },
        { left: card(null, 'åº§'), right: card(null, 'å±±')   },
        { left: card(null, 'å¯¹'), right: card(null, 'é¸Ÿ')   },
        { left: card(null, 'åŒ'), right: card(null, 'é‹')   },
        { left: card(null, 'å¥—'), right: card(null, 'è¡£æœ') },
      ]
    },
    {
      // ç§ ä¸œè¥¿ | åŒ¹ ç‹¼ | æ ¹ ç»³å­ | å› è€å¸ˆ | åº§ é«˜æ¥¼ | åŒ æ‰‹ | æ£µ èœ | ä»¶ è¡£æœ
      id: 4, cls: 'lv4',
      label:      'â­â­â­â­ Level 4 â€” Measure Words é‡è¯ï¼ˆå››ï¼‰',
      shortLabel: 'â­â­â­â­ Level 4',
      pairs: [
        { left: card(null, 'ç§'), right: card(null, 'ä¸œè¥¿') },
        { left: card(null, 'åŒ¹'), right: card(null, 'ç‹¼')   },
        { left: card(null, 'æ ¹'), right: card(null, 'ç»³å­') },
        { left: card(null, 'å›'), right: card(null, 'è€å¸ˆ') },
        { left: card(null, 'åº§'), right: card(null, 'é«˜æ¥¼') },
        { left: card(null, 'åŒ'), right: card(null, 'æ‰‹')   },
        { left: card(null, 'æ£µ'), right: card(null, 'èœ')   },
        { left: card(null, 'ä»¶'), right: card(null, 'è¡£æœ') },
      ]
    },
    {
      // å— çŸ³å¤´ | ç¾¤ å°å­© | ç‰‡ å¶å­ | é¢— æ˜Ÿæ˜Ÿ | ç“¶ ç‰›å¥¶ | å¤´ å¤§è±¡ | åŒ¹ é©¬(confusable) already covered
      // No å¤´â†”é©¬, åŒ¹â†”å¤§è±¡ confusion here â€” å¤´ and åŒ¹ not in same level
      id: 5, cls: 'lv5',
      label:      'â­â­â­â­â­ Level 5 â€” Measure Words é‡è¯ï¼ˆäº”ï¼‰',
      shortLabel: 'â­â­â­â­â­ Level 5',
      pairs: [
        { left: card(null, 'å—'), right: card(null, 'çŸ³å¤´') },
        { left: card(null, 'ç¾¤'), right: card(null, 'å°å­©') },
        { left: card(null, 'ç‰‡'), right: card(null, 'å¶å­') },
        { left: card(null, 'é¢—'), right: card(null, 'æ˜Ÿæ˜Ÿ') },
        { left: card(null, 'ç“¶'), right: card(null, 'ç‰›å¥¶') },
        { left: card(null, 'å¤´'), right: card(null, 'å¤§è±¡') },
        { left: card(null, 'å¯¹'), right: card('bÄo tÄi', 'åŒèƒèƒ') },
        { left: card(null, 'æœµ'), right: card(null, 'æµªèŠ±') },
      ]
    },
    {
      // å— è›‹ç³• | ç¾¤ é¸¡ | ç‰‡ æ²™æ»© | é¢— ç‰™é½¿ | ç“¶ è¯ | å¤´ è€è™ | é¢— èŠ±ç”Ÿ | æ ¹ ç‰ç±³
      id: 6, cls: 'lv6',
      label:      'â­â­â­â­â­â­ Level 6 â€” Measure Words é‡è¯ï¼ˆå…­ï¼‰',
      shortLabel: 'â­â­â­â­â­â­ Level 6',
      pairs: [
        { left: card(null, 'å—'), right: card(null, 'è›‹ç³•') },
        { left: card(null, 'ç¾¤'), right: card(null, 'é¸¡')   },
        { left: card(null, 'ç‰‡'), right: card(null, 'æ²™æ»©') },
        { left: card(null, 'é¢—'), right: card(null, 'ç‰™é½¿') },
        { left: card(null, 'ç“¶'), right: card(null, 'è¯')   },
        { left: card(null, 'å¤´'), right: card(null, 'è€è™') },
        { left: card(null, 'æ ¹'), right: card(null, 'ç‰ç±³') },
        { left: card(null, 'ç§'), right: card(null, 'åŠ¨ç‰©') },
      ]
    },
    {
      // å— æœ¨å¤´ | ç¾¤ ç‹ç‹¸ | ç‰‡ å¤©ç©º | é¢— è‘¡è„ | ç“¶ æ²¹ | å¤´ éª†é©¼ | åŒ ç­·å­ | åº§ æˆ¿å­
      // (åŒç­·å­ not in same level as æ ¹ç­·å­ â€” âœ“ L3 has æ ¹ç­·å­, here åŒç­·å­)
      id: 7, cls: 'lv7',
      label:      'â­â­â­â­â­â­â­ Level 7 â€” Measure Words é‡è¯ï¼ˆä¸ƒï¼‰',
      shortLabel: 'â­â­â­â­â­â­â­ Level 7',
      pairs: [
        { left: card(null, 'å—'), right: card(null, 'æœ¨å¤´') },
        { left: card(null, 'ç¾¤'), right: card(null, 'ç‹ç‹¸') },
        { left: card(null, 'ç‰‡'), right: card(null, 'å¤©ç©º') },
        { left: card(null, 'é¢—'), right: card(null, 'è‘¡è„') },
        { left: card(null, 'ç“¶'), right: card(null, 'æ²¹')   },
        { left: card(null, 'å¤´'), right: card(null, 'éª†é©¼') },
        { left: card(null, 'åŒ'), right: card(null, 'ç­·å­') },
        { left: card(null, 'åº§'), right: card(null, 'æˆ¿å­') },
      ]
    },
    {
      // å¥— ä¹¦ | é¢ å¢™ | æ ¹ çº¿ | åŒ è„š | é¡¶ ä¼ | ç§ ç¬” | åŒ¹ å¸ƒ | åº§ æ¡¥
      // å¥—â†”ä¹¦ (å¥—â†”è¡£æœ was L3 â€” different level âœ“)
      // æ ¹â†”çº¿ (æ ¹â†”ç­·å­ L3, æ ¹â†”ç»³å­ L4, æ ¹â†”ç‰ç±³ L6 â€” no åŒâ†”ç­·å­ in same level since åŒâ†”è„š here âœ“)
      id: 8, cls: 'lv8',
      label:      'â­â­â­â­â­â­â­â­ Level 8 â€” Measure Words é‡è¯ï¼ˆå…«ï¼‰',
      shortLabel: 'â­â­â­â­â­â­â­â­ Level 8',
      pairs: [
        { left: card(null, 'å¥—'), right: card(null, 'ä¹¦')   },
        { left: card(null, 'é¢'), right: card(null, 'å¢™')   },
        { left: card(null, 'æ ¹'), right: card(null, 'çº¿')   },
        { left: card(null, 'åŒ'), right: card(null, 'è„š')   },
        { left: card(null, 'é¡¶'), right: card(null, 'ä¼')   },
        { left: card(null, 'ç§'), right: card(null, 'ç¬”')   },
        { left: card(null, 'åŒ¹'), right: card(null, 'å¸ƒ')   },
        { left: card(null, 'åº§'), right: card(null, 'æ¡¥')   },
      ]
    },
    {
      // å¤´ ç‰› | ç“¶ æ°´ | é¢— èŠ±ç”Ÿ | ç¾¤ è€äºº | ç‰‡ æµ·æ´‹ | å— è‚‰ | é“ é¢˜ç›® | æ ¹ æœ¨æ£’
      // å—â†”è‚‰ and ç‰‡â†”è‚‰ never in same level (ç‰‡â†”æµ·æ´‹ here, not ç‰‡â†”è‚‰ âœ“)
      id: 9, cls: 'lv9',
      label:      'â­â­â­â­â­â­â­â­â­ Level 9 â€” Measure Words é‡è¯ï¼ˆä¹ï¼‰',
      shortLabel: 'â­â­â­â­â­â­â­â­â­ Level 9',
      pairs: [
        { left: card(null, 'å¤´'), right: card(null, 'ç‰›')   },
        { left: card(null, 'ç“¶'), right: card(null, 'æ°´')   },
        { left: card(null, 'é¢—'), right: card(null, 'èŠ±ç”Ÿ') },
        { left: card(null, 'ç¾¤'), right: card(null, 'è€äºº') },
        { left: card(null, 'ç‰‡'), right: card(null, 'æµ·æ´‹') },
        { left: card(null, 'å—'), right: card(null, 'è‚‰')   },
        { left: card(null, 'é“'), right: card(null, 'é¢˜ç›®') },
        { left: card(null, 'æ ¹'), right: card(null, 'æœ¨æ£’') },
      ]
    },
    {
      // å¤´ çŒª | ç“¶ ç› | é¢— ç³–æœ | ç¾¤ é¸Ÿ | ç‰‡ è‰åœ° | å— æ°´æœ | é“ ç‚¹å¿ƒ | æ ¹ å¤´å‘
      // ç¾¤â†”é¸Ÿ (å¯¹â†”é¸Ÿ was L3 â€” different level âœ“)
      // ç‰‡â†”è‰åœ° (æ£µâ†”è‰ was L2; æ ¹â†”è‰ not used â€” âœ“ no æ£µ or æ ¹ in same level)
      // å—â†”æ°´æœ (ç‰‡â†”åˆ‡æˆç‰‡æ°´æœ different level âœ“)
      id: 10, cls: 'lv10',
      label:      'â­â­â­â­â­â­â­â­â­â­ Level 10 â€” Measure Words é‡è¯ï¼ˆåï¼‰',
      shortLabel: 'â­â­â­â­â­â­â­â­â­â­ Level 10',
      pairs: [
        { left: card(null, 'å¤´'), right: card(null, 'çŒª')   },
        { left: card(null, 'ç“¶'), right: card(null, 'ç›')   },
        { left: card(null, 'é¢—'), right: card(null, 'ç³–æœ') },
        { left: card(null, 'ç¾¤'), right: card(null, 'é¸Ÿ')   },
        { left: card(null, 'ç‰‡'), right: card(null, 'è‰åœ°') },
        { left: card(null, 'å—'), right: card(null, 'æ°´æœ') },
        { left: card(null, 'é“'), right: card(null, 'ç‚¹å¿ƒ') },
        { left: card(null, 'æ ¹'), right: card(null, 'å¤´å‘') },
      ]
    },
    {
      // å¤´ ç‹®å­ | ç“¶ ç™½ç³– | é¢— å°çŸ³å­ | ç¾¤ ç¾Š | ç‰‡ æ ‘æ— | ç‰‡ è‚‰ â€” conflict! use ç‰‡â†”é¥¼å¹²
      // å¤´ ç‰› L9, å¤´ çŒª L10 â†’ å¤´ ç‹®å­ L11 âœ“
      // ç‰‡â†”é¥¼å¹² (ç‰‡â†”å¶å­ L5, ç‰‡â†”æ²™æ»© L6, ç‰‡â†”å¤©ç©º L7, ç‰‡â†”æµ·æ´‹ L9, ç‰‡â†”è‰åœ° L10 â€” âœ“)
      id: 11, cls: 'lv11',
      label:      'â­â­â­â­â­â­â­â­â­â­â­ Level 11 â€” Measure Words é‡è¯ï¼ˆåä¸€ï¼‰',
      shortLabel: 'â­â­â­â­â­â­â­â­â­â­â­ Level 11',
      pairs: [
        { left: card(null, 'å¤´'), right: card(null, 'ç‹®å­') },
        { left: card(null, 'ç“¶'), right: card(null, 'ç™½ç³–') },
        { left: card(null, 'é¢—'), right: card(null, 'å°çŸ³å­') },
        { left: card(null, 'ç¾¤'), right: card(null, 'ç¾Š')   },
        { left: card(null, 'ç‰‡'), right: card(null, 'é¥¼å¹²') },
        { left: card(null, 'ç§'), right: card(null, 'èœ')   },
        { left: card(null, 'é“'), right: card(null, 'çº¿æ¡') },
        { left: card(null, 'æ ¹'), right: card(null, 'è‰')   },
      ]
    },
  ]
};

/* â”€â”€ Master pack registry â”€â”€ */
const GAME_PACKS = [PACK_STROKES, PACK_ANTONYMS, PACK_MEASURE];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentPackIdx  = 0;
let currentLevel    = 0;
let currentPairs    = [];   // pairs for this level (in original order)
let leftOrder       = [];   // shuffled indices into currentPairs
let rightOrder      = [];   // shuffled indices into currentPairs
let selectedLeft    = null; // pair index selected on the left
let selectedRight   = null; // pair index selected on the right
let connections     = {};   // leftIdx -> rightIdx (matched pairs)
let wrongPairs      = new Set();
let levelWrong      = 0;
let feedbackTimer   = null;
let drawingLine     = null;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function getDotCenter(el) {
  const wrapper = document.getElementById('game-wrapper');
  const wr = wrapper.getBoundingClientRect();
  const er = el.getBoundingClientRect();
  return { x: er.left + er.width / 2 - wr.left, y: er.top + er.height / 2 - wr.top };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARD RENDERER  â€” generic, handles pinyin + chinese + image
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildCardInner(cardData) {
  const parts = [];
  if (cardData.pinyin)               parts.push(`<div class="card-pinyin">${cardData.pinyin}</div>`);
  if (cardData.chinese && !cardData.img) parts.push(`<div class="card-chinese">${cardData.chinese}</div>`);
  if (cardData.img)                  parts.push(`<img class="card-img" src="${cardData.img}" alt="${cardData.chinese || ''}"
      onerror="this.outerHTML='<div class=\\'img-error\\'>å›¾ç‰‡åŠ è½½å¤±è´¥</div>'" />`);
  return parts.join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILD ROUND
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildRound() {
  const pack  = GAME_PACKS[currentPackIdx];
  const level = pack.levels[currentLevel];
  currentPairs = level.pairs;
  leftOrder    = shuffle([...Array(currentPairs.length).keys()]);
  rightOrder   = shuffle([...Array(currentPairs.length).keys()]);
  connections  = {};
  wrongPairs   = new Set();
  levelWrong   = 0;
  selectedLeft  = null;
  selectedRight = null;
  drawingLine   = null;
  renderColumns();
  clearSVG();
  updateLevelBadge();
  updateRoundInfo();
  updateScoreboard();
  updateAttribution();
}

function renderColumns() {
  const colL = document.getElementById('col-left');
  const colR = document.getElementById('col-right');
  colL.innerHTML = '';
  colR.innerHTML = '';

  leftOrder.forEach(pairIdx => {
    const pair = currentPairs[pairIdx];
    const card = document.createElement('div');
    card.className = 'match-card left-card';
    card.dataset.pairIdx = pairIdx;
    card.innerHTML = `
      <div class="card-row">
        <div class="card-content">${buildCardInner(pair.left)}</div>
        <div class="dot-right" id="dot-left-${pairIdx}"></div>
      </div>`;
    card.addEventListener('pointerdown', e => onLeftDown(e, pairIdx));
    colL.appendChild(card);
  });

  rightOrder.forEach(pairIdx => {
    const pair = currentPairs[pairIdx];
    const card = document.createElement('div');
    card.className = 'match-card right-card';
    card.dataset.pairIdx = pairIdx;
    card.innerHTML = `
      <div class="card-row">
        <div class="dot-left" id="dot-right-${pairIdx}"></div>
        <div class="card-content">${buildCardInner(pair.right)}</div>
      </div>`;
    card.addEventListener('pointerdown', e => onRightDown(e, pairIdx));
    colR.appendChild(card);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SVG LINE HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function clearSVG() { document.getElementById('line-canvas').innerHTML = ''; }

function makeLine(cls) {
  const svg  = document.getElementById('line-canvas');
  const line = document.createElementNS('http://www.w3.org/2000/svg', 'path');
  line.setAttribute('class', `connector-line ${cls}`);
  svg.appendChild(line);
  return line;
}

function setLinePath(lineEl, x1, y1, x2, y2) {
  const mx = (x1 + x2) / 2;
  lineEl.setAttribute('d', `M${x1},${y1} C${mx},${y1} ${mx},${y2} ${x2},${y2}`);
}

function removeDrawingLine() {
  if (drawingLine) { drawingLine.remove(); drawingLine = null; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTERACTION â€” Left card (drag or tap)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function onLeftDown(e, pairIdx) {
  e.preventDefault();
  if (connections[pairIdx] !== undefined) return;

  // Complete a rightâ†’left tap-tap connection
  if (selectedRight !== null) {
    const rightPairIdx = selectedRight;
    clearRightSelection();
    removeDrawingLine();
    attemptConnect(pairIdx, rightPairIdx, pairIdx === rightPairIdx);
    return;
  }

  if (selectedLeft === pairIdx) { clearLeftSelection(); removeDrawingLine(); return; }

  clearLeftSelection();
  removeDrawingLine();

  selectedLeft = pairIdx;
  document.querySelector(`.left-card[data-pair-idx="${pairIdx}"]`).classList.add('selected');

  const dot    = document.getElementById(`dot-left-${pairIdx}`);
  const origin = getDotCenter(dot);
  drawingLine  = makeLine('line-pending');
  setLinePath(drawingLine, origin.x, origin.y, origin.x, origin.y);

  const startX = e.clientX, startY = e.clientY;
  let isDrag = false;

  function onMove(ev) {
    if (!drawingLine) return;
    const wr = document.getElementById('game-wrapper').getBoundingClientRect();
    setLinePath(drawingLine, origin.x, origin.y, ev.clientX - wr.left, ev.clientY - wr.top);
    if (!isDrag && (Math.abs(ev.clientX - startX) > 8 || Math.abs(ev.clientY - startY) > 8)) isDrag = true;
  }

  function onUp(ev) {
    window.removeEventListener('pointermove', onMove);
    window.removeEventListener('pointerup',   onUp);

    const el        = document.elementFromPoint(ev.clientX, ev.clientY);
    const rightCard = el && el.closest('.right-card');

    if (rightCard && selectedLeft !== null) {
      const rightPairIdx = parseInt(rightCard.dataset.pairIdx);
      if (connections[rightPairIdx] === undefined) {
        const leftPairIdx = selectedLeft;
        clearLeftSelection();
        removeDrawingLine();
        attemptConnect(leftPairIdx, rightPairIdx, leftPairIdx === rightPairIdx);
        return;
      }
    }

    removeDrawingLine();
    if (isDrag) clearLeftSelection();
  }

  window.addEventListener('pointermove', onMove);
  window.addEventListener('pointerup',   onUp);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTERACTION â€” Right card (tap-tap mode)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function onRightDown(e, rightPairIdx) {
  e.preventDefault();
  if (connections[rightPairIdx] !== undefined) return;

  // Complete a leftâ†’right tap-tap connection
  if (selectedLeft !== null) {
    const leftPairIdx = selectedLeft;
    clearLeftSelection();
    removeDrawingLine();
    attemptConnect(leftPairIdx, rightPairIdx, leftPairIdx === rightPairIdx);
    return;
  }

  // Toggle right selection off
  if (selectedRight === rightPairIdx) { clearRightSelection(); removeDrawingLine(); return; }

  clearRightSelection();
  removeDrawingLine();

  selectedRight = rightPairIdx;
  document.querySelector(`.right-card[data-pair-idx="${rightPairIdx}"]`).classList.add('selected');

  const dot    = document.getElementById(`dot-right-${rightPairIdx}`);
  const origin = getDotCenter(dot);
  drawingLine  = makeLine('line-pending');
  setLinePath(drawingLine, origin.x, origin.y, origin.x, origin.y);

  const startX = e.clientX, startY = e.clientY;
  let isDrag = false;

  function onMove(ev) {
    if (!drawingLine) return;
    const wr = document.getElementById('game-wrapper').getBoundingClientRect();
    setLinePath(drawingLine, ev.clientX - wr.left, ev.clientY - wr.top, origin.x, origin.y);
    if (!isDrag && (Math.abs(ev.clientX - startX) > 8 || Math.abs(ev.clientY - startY) > 8)) isDrag = true;
  }

  function onUp(ev) {
    window.removeEventListener('pointermove', onMove);
    window.removeEventListener('pointerup',   onUp);

    const el       = document.elementFromPoint(ev.clientX, ev.clientY);
    const leftCard = el && el.closest('.left-card');

    if (leftCard && selectedRight !== null) {
      const leftPairIdx = parseInt(leftCard.dataset.pairIdx);
      if (connections[leftPairIdx] === undefined) {
        const rPairIdx = selectedRight;
        clearRightSelection();
        removeDrawingLine();
        attemptConnect(leftPairIdx, rightPairIdx, leftPairIdx === rPairIdx);
        return;
      }
    }

    removeDrawingLine();
    if (isDrag) clearRightSelection();
  }

  window.addEventListener('pointermove', onMove);
  window.addEventListener('pointerup',   onUp);
}

function clearLeftSelection() {
  if (selectedLeft !== null) {
    const card = document.querySelector(`.left-card[data-pair-idx="${selectedLeft}"]`);
    if (card) card.classList.remove('selected');
    selectedLeft = null;
  }
}

function clearRightSelection() {
  if (selectedRight !== null) {
    const card = document.querySelector(`.right-card[data-pair-idx="${selectedRight}"]`);
    if (card) card.classList.remove('selected');
    selectedRight = null;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONNECTION LOGIC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function attemptConnect(leftPairIdx, rightPairIdx, correct) {
  const leftDot  = document.getElementById(`dot-left-${leftPairIdx}`);
  const rightDot = document.getElementById(`dot-right-${rightPairIdx}`);
  const p1 = getDotCenter(leftDot);
  const p2 = getDotCenter(rightDot);

  if (correct) {
    connections[leftPairIdx] = rightPairIdx;
    const line = makeLine('line-correct');
    setLinePath(line, p1.x, p1.y, p2.x, p2.y);
    document.querySelector(`.left-card[data-pair-idx="${leftPairIdx}"]`).classList.add('matched');
    document.querySelector(`.right-card[data-pair-idx="${rightPairIdx}"]`).classList.add('matched');
    showFeedback(true, currentPairs[leftPairIdx]);
    updateScoreboard();
    if (Object.keys(connections).length === currentPairs.length) setTimeout(showRoundComplete, 800);
  } else {
    levelWrong++;
    const key = `${leftPairIdx}-${rightPairIdx}`;
    if (!wrongPairs.has(key)) {
      wrongPairs.add(key);
      const line = makeLine('line-wrong');
      setLinePath(line, p1.x, p1.y, p2.x, p2.y);
      line.classList.add('line-flash');
      setTimeout(() => line.remove(), 900);
    }
    [['left-card', leftPairIdx], ['right-card', rightPairIdx]].forEach(([cls, idx]) => {
      const c = document.querySelector(`.${cls}[data-pair-idx="${idx}"]`);
      if (c) { c.classList.add('wrong'); setTimeout(() => c.classList.remove('wrong'), 400); }
    });
    showFeedback(false);
    updateScoreboard();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FEEDBACK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showFeedback(correct, pair) {
  clearTimeout(feedbackTimer);
  const fb = document.getElementById('feedback');
  document.getElementById('fb-emoji').textContent = correct ? 'ğŸ‰' : 'âŒ';
  document.getElementById('fb-msg').textContent   = correct ? 'Correct! æ­£ç¡®ï¼' : 'Try again! å†è¯•è¯•ï¼';

  if (correct && pair) {
    const l = pair.left, r = pair.right;
    const lStr = [l.pinyin, l.chinese].filter(Boolean).join(' ');
    const rStr = [r.pinyin, r.chinese].filter(Boolean).join(' ');
    document.getElementById('fb-sub').textContent = `${lStr}  â†”  ${rStr}`;
  } else {
    document.getElementById('fb-sub').textContent = "That doesn't match â€” try a different pair.";
  }

  fb.classList.add('show');

  // Dismiss on the very next pointer event anywhere on the page
  const dismiss = () => {
    clearTimeout(feedbackTimer);
    fb.classList.remove('show');
  };
  feedbackTimer = setTimeout(dismiss, correct ? 1400 : 1200);
  document.addEventListener('pointerdown', dismiss, { once: true, capture: true });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCOREBOARD / PROGRESS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateScoreboard() {
  const matched = Object.keys(connections).length;
  document.getElementById('score-correct').textContent = matched;
  document.getElementById('score-total').textContent   = currentPairs.length;
  document.getElementById('score-wrong').textContent   = levelWrong;

  const pack        = GAME_PACKS[currentPackIdx];
  const totalPairs  = pack.levels.reduce((s, l) => s + l.pairs.length, 0);
  const doneBefore  = pack.levels.slice(0, currentLevel).reduce((s, l) => s + l.pairs.length, 0);
  const pct         = Math.round((doneBefore + matched) / totalPairs * 100);
  document.getElementById('progress-bar').style.width = pct + '%';
}

function updateLevelBadge() {
  const pack  = GAME_PACKS[currentPackIdx];
  const lv    = pack.levels[currentLevel];
  const total = pack.levels.length;
  const badge = document.getElementById('level-badge');
  badge.textContent = `${lv.shortLabel} of ${total}`;
  badge.className   = `level-badge ${lv.cls}`;
}

function updateRoundInfo() {
  const lv  = GAME_PACKS[currentPackIdx].levels[currentLevel];
  document.getElementById('round-info').textContent =
    `${lv.label} â€” match all ${currentPairs.length} pairs to advance`;
}

function updateAttribution() {
  const pack   = GAME_PACKS[currentPackIdx];
  const footer = document.getElementById('attr-img');
  footer.style.display = pack.attribution ? 'block' : 'none';
  if (pack.attribution) footer.innerHTML = pack.attribution;

  // Update page title
  document.getElementById('app-title').textContent =
    `${pack.icon} ${pack.nameCN} â€” ${pack.name}`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LEVEL COMPLETE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showRoundComplete() {
  const pack    = GAME_PACKS[currentPackIdx];
  const isLast  = currentLevel === pack.levels.length - 1;
  const matched = Object.keys(connections).length;
  const attempts = matched + levelWrong;
  const accuracy = attempts === 0 ? 100 : Math.round(matched / attempts * 100);
  const stars    = levelWrong === 0 ? 'â­â­â­' : levelWrong <= 2 ? 'â­â­' : 'â­';

  document.getElementById('co-emoji').textContent = isLast ? 'ğŸ†' : 'ğŸ‰';
  document.getElementById('co-stars').textContent = stars;
  document.getElementById('co-title').textContent = isLast ? 'å…¨éƒ¨å®Œæˆï¼All Done!' : 'å¤ªæ£’äº†ï¼Great job!';

  const nextLv = !isLast ? pack.levels[currentLevel + 1] : null;
  document.getElementById('co-stats').textContent = isLast
    ? `All ${matched} pairs mastered! ğŸŠ`
    : `Accuracy: ${accuracy}%  |  Mistakes: ${levelWrong}  |  Next: ${nextLv.shortLabel}`;

  const btn = document.getElementById('co-btn');
  if (isLast) {
    btn.textContent = 'ğŸ”„ Play Again';
    btn.onclick = resetAll;
  } else {
    btn.textContent = `â–¶ Level ${currentLevel + 2}`;
    btn.onclick = nextLevel;
  }

  document.getElementById('complete-overlay').classList.add('show');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function nextLevel() {
  document.getElementById('complete-overlay').classList.remove('show');
  currentLevel++;
  const pack = GAME_PACKS[currentPackIdx];
  if (currentLevel >= pack.levels.length) { resetAll(); return; }
  buildRound();
}

function retryLevel() {
  clearSVG();
  leftOrder    = shuffle([...Array(currentPairs.length).keys()]);
  rightOrder   = shuffle([...Array(currentPairs.length).keys()]);
  connections  = {};
  wrongPairs   = new Set();
  levelWrong   = 0;
  selectedLeft  = null;
  selectedRight = null;
  renderColumns();
  updateRoundInfo();
  updateScoreboard();
}

function resetAll() {
  document.getElementById('complete-overlay').classList.remove('show');
  currentLevel = 0;
  levelWrong   = 0;
  buildRound();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME SELECTOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openSelector() {
  const list = document.getElementById('pack-list');
  list.innerHTML = '';
  GAME_PACKS.forEach((pack, idx) => {
    const item = document.createElement('div');
    item.className = 'pack-item' + (idx === currentPackIdx ? ' active-pack' : '');
    item.innerHTML = `
      <div class="pack-icon">${pack.icon}</div>
      <div class="pack-info">
        <div class="pack-name">${pack.nameCN} &nbsp; ${pack.name}</div>
        <div class="pack-desc">${pack.desc}</div>
        <div class="pack-levels">${pack.levels.length} level${pack.levels.length > 1 ? 's' : ''} &nbsp;Â·&nbsp;
          ${pack.levels.reduce((s, l) => s + l.pairs.length, 0)} pairs total</div>
      </div>`;
    item.addEventListener('click', () => loadPack(idx));
    list.appendChild(item);
  });
  document.getElementById('selector-overlay').classList.add('show');
}

function closeSelector() {
  document.getElementById('selector-overlay').classList.remove('show');
}

function loadPack(idx) {
  currentPackIdx = idx;
  currentLevel   = 0;
  closeSelector();
  buildRound();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleHelp() {
  alert(
    'ğŸ“– HOW TO PLAY\n\n' +
    '1. Tap / click an item on the LEFT side.\n' +
    '2. Drag (or tap) to its matching item on the RIGHT.\n' +
    '3. A green line = correct match âœ…\n' +
    '   A red flash  = wrong pair âŒ\n' +
    '4. Match all pairs to finish the round!\n' +
    '5. Use "Switch Game" to choose a different category.\n\n' +
    'ç©æ³•è¯´æ˜ï¼š\n' +
    'ç‚¹å‡»å·¦ä¾§é€‰é¡¹ï¼Œæ‹–çº¿è¿åˆ°å³ä¾§å¯¹åº”ç­”æ¡ˆã€‚\n' +
    'ç»¿çº¿è¡¨ç¤ºæ­£ç¡®ï¼Œçº¢è‰²é—ªçƒè¡¨ç¤ºé”™è¯¯ã€‚\n' +
    'å…¨éƒ¨è¿å¯¹å³å¯è¿‡å…³ï¼\n' +
    'ç‚¹å‡»"Switch Game"åˆ‡æ¢ä¸åŒç»ƒä¹ ä¸»é¢˜ã€‚'
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESIZE â€” redraw lines
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('resize', () => {
  clearSVG();
  Object.entries(connections).forEach(([leftPairIdx, rightPairIdx]) => {
    const ld = document.getElementById(`dot-left-${leftPairIdx}`);
    const rd = document.getElementById(`dot-right-${rightPairIdx}`);
    if (ld && rd) {
      const line = makeLine('line-correct');
      setLinePath(line, ...Object.values(getDotCenter(ld)), ...Object.values(getDotCenter(rd)));
    }
  });
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
buildRound();
</script>
</body>
</html>
